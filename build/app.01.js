(()=>{var Mi=Object.defineProperty;var Ei=(i,t,e)=>t in i?Mi(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var P=(i,t,e)=>(Ei(i,typeof t!="symbol"?t+"":t,e),e);var J=class{constructor(){this.create()}resize(){}render(t){}create(){this.start()}start(){}destroy(){}transitionOut(t){return new Promise(e=>{setTimeout(()=>{e()},100)})}transitionIn(t){return new Promise(e=>{setTimeout(()=>{e()},100)})}};var tt=class{constructor(){this.resize()}resize(){document.documentElement.style.setProperty("--100vh",`${window.innerHeight}px`)}};function yt(){return yt=Object.assign?Object.assign.bind():function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=e[s])}return i},yt.apply(this,arguments)}function et(i,t,e){return Math.max(i,Math.min(t,e))}var vt=class{advance(t){var e;if(!this.isRunning)return;let s=!1;if(this.lerp)this.value=(r=this.value,n=this.to,(1-(h=1-Math.exp(-60*this.lerp*t)))*r+h*n),Math.round(this.value)===this.to&&(this.value=this.to,s=!0);else{this.currentTime+=t;let a=et(0,this.currentTime/this.duration,1);s=a>=1;let o=s?1:this.easing(a);this.value=this.from+(this.to-this.from)*o}var r,n,h;(e=this.onUpdate)==null||e.call(this,this.value,s),s&&this.stop()}stop(){this.isRunning=!1}fromTo(t,e,{lerp:s=.1,duration:r=1,easing:n=o=>o,onStart:h,onUpdate:a}){this.from=this.value=t,this.to=e,this.lerp=s,this.duration=r,this.easing=n,this.currentTime=0,this.isRunning=!0,h==null||h(),this.onUpdate=a}},Mt=class{constructor({wrapper:t,content:e,autoResize:s=!0}={}){if(this.resize=()=>{this.onWrapperResize(),this.onContentResize()},this.onWrapperResize=()=>{this.wrapper===window?(this.width=window.innerWidth,this.height=window.innerHeight):(this.width=this.wrapper.clientWidth,this.height=this.wrapper.clientHeight)},this.onContentResize=()=>{this.scrollHeight=this.content.scrollHeight,this.scrollWidth=this.content.scrollWidth},this.wrapper=t,this.content=e,s){let r=function(n,h){let a;return function(){let o=arguments,l=this;clearTimeout(a),a=setTimeout(function(){n.apply(l,o)},250)}}(this.resize);this.wrapper!==window&&(this.wrapperResizeObserver=new ResizeObserver(r),this.wrapperResizeObserver.observe(this.wrapper)),this.contentResizeObserver=new ResizeObserver(r),this.contentResizeObserver.observe(this.content)}this.resize()}destroy(){var t,e;(t=this.wrapperResizeObserver)==null||t.disconnect(),(e=this.contentResizeObserver)==null||e.disconnect()}get limit(){return{x:this.scrollWidth-this.width,y:this.scrollHeight-this.height}}},it=class{constructor(){this.events={}}emit(t,...e){let s=this.events[t]||[];for(let r=0,n=s.length;r<n;r++)s[r](...e)}on(t,e){var s;return(s=this.events[t])!=null&&s.push(e)||(this.events[t]=[e]),()=>{var r;this.events[t]=(r=this.events[t])==null?void 0:r.filter(n=>e!==n)}}off(t,e){var s;this.events[t]=(s=this.events[t])==null?void 0:s.filter(r=>e!==r)}destroy(){this.events={}}},Et=class{constructor(t,{wheelMultiplier:e=1,touchMultiplier:s=2,normalizeWheel:r=!1}){this.onTouchStart=n=>{let{clientX:h,clientY:a}=n.targetTouches?n.targetTouches[0]:n;this.touchStart.x=h,this.touchStart.y=a,this.lastDelta={x:0,y:0}},this.onTouchMove=n=>{let{clientX:h,clientY:a}=n.targetTouches?n.targetTouches[0]:n,o=-(h-this.touchStart.x)*this.touchMultiplier,l=-(a-this.touchStart.y)*this.touchMultiplier;this.touchStart.x=h,this.touchStart.y=a,this.lastDelta={x:o,y:l},this.emitter.emit("scroll",{deltaX:o,deltaY:l,event:n})},this.onTouchEnd=n=>{this.emitter.emit("scroll",{deltaX:this.lastDelta.x,deltaY:this.lastDelta.y,event:n})},this.onWheel=n=>{let{deltaX:h,deltaY:a}=n;this.normalizeWheel&&(h=et(-100,h,100),a=et(-100,a,100)),h*=this.wheelMultiplier,a*=this.wheelMultiplier,this.emitter.emit("scroll",{deltaX:h,deltaY:a,event:n})},this.element=t,this.wheelMultiplier=e,this.touchMultiplier=s,this.normalizeWheel=r,this.touchStart={x:null,y:null},this.emitter=new it,this.element.addEventListener("wheel",this.onWheel,{passive:!1}),this.element.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.element.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.element.addEventListener("touchend",this.onTouchEnd,{passive:!1})}on(t,e){return this.emitter.on(t,e)}destroy(){this.emitter.destroy(),this.element.removeEventListener("wheel",this.onWheel,{passive:!1}),this.element.removeEventListener("touchstart",this.onTouchStart,{passive:!1}),this.element.removeEventListener("touchmove",this.onTouchMove,{passive:!1}),this.element.removeEventListener("touchend",this.onTouchEnd,{passive:!1})}},st=class{constructor({wrapper:t=window,content:e=document.documentElement,wheelEventsTarget:s=t,eventsTarget:r=s,smoothWheel:n=!0,smoothTouch:h=!1,syncTouch:a=!1,syncTouchLerp:o=.1,__iosNoInertiaSyncTouchLerp:l=.4,touchInertiaMultiplier:c=35,duration:f,easing:p=v=>Math.min(1,1.001-Math.pow(2,-10*v)),lerp:d=!f&&.1,infinite:u=!1,orientation:m="vertical",gestureOrientation:g="vertical",touchMultiplier:x=1,wheelMultiplier:S=1,normalizeWheel:M=!1,autoResize:w=!0}={}){this.onVirtualScroll=({deltaX:v,deltaY:y,event:T})=>{if(T.ctrlKey)return;let A=T.type.includes("touch"),L=T.type.includes("wheel");if(this.options.gestureOrientation==="both"&&v===0&&y===0||this.options.gestureOrientation==="vertical"&&y===0||this.options.gestureOrientation==="horizontal"&&v===0||A&&this.options.gestureOrientation==="vertical"&&this.scroll===0&&!this.options.infinite&&y<=0)return;let b=T.composedPath();if(b=b.slice(0,b.indexOf(this.rootElement)),b.find(E=>{var U;return(E.hasAttribute==null?void 0:E.hasAttribute("data-lenis-prevent"))||A&&(E.hasAttribute==null?void 0:E.hasAttribute("data-lenis-prevent-touch"))||L&&(E.hasAttribute==null?void 0:E.hasAttribute("data-lenis-prevent-wheel"))||((U=E.classList)==null?void 0:U.contains("lenis"))}))return;if(this.isStopped||this.isLocked)return void T.preventDefault();if(this.isSmooth=(this.options.smoothTouch||this.options.syncTouch)&&A||this.options.smoothWheel&&L,!this.isSmooth)return this.isScrolling=!1,void this.animate.stop();T.preventDefault();let F=y;this.options.gestureOrientation==="both"?F=Math.abs(y)>Math.abs(v)?y:v:this.options.gestureOrientation==="horizontal"&&(F=v);let C=A&&this.options.syncTouch,z=A&&T.type==="touchend"&&Math.abs(F)>1;z&&(F=this.velocity*this.options.touchInertiaMultiplier),this.scrollTo(this.targetScroll+F,yt({programmatic:!1},C&&{lerp:z?this.syncTouchLerp:this.options.__iosNoInertiaSyncTouchLerp}))},this.onScroll=()=>{if(!this.isScrolling){let v=this.animatedScroll;this.animatedScroll=this.targetScroll=this.actualScroll,this.velocity=0,this.direction=Math.sign(this.animatedScroll-v),this.emit()}},window.lenisVersion="1.0.27",t!==document.documentElement&&t!==document.body||(t=window),this.options={wrapper:t,content:e,wheelEventsTarget:s,eventsTarget:r,smoothWheel:n,smoothTouch:h,syncTouch:a,syncTouchLerp:o,__iosNoInertiaSyncTouchLerp:l,touchInertiaMultiplier:c,duration:f,easing:p,lerp:d,infinite:u,gestureOrientation:g,orientation:m,touchMultiplier:x,wheelMultiplier:S,normalizeWheel:M,autoResize:w},this.animate=new vt,this.emitter=new it,this.dimensions=new Mt({wrapper:t,content:e,autoResize:w}),this.toggleClass("lenis",!0),this.velocity=0,this.isLocked=!1,this.isStopped=!1,this.isSmooth=a||n||h,this.isScrolling=!1,this.targetScroll=this.animatedScroll=this.actualScroll,this.options.wrapper.addEventListener("scroll",this.onScroll,{passive:!1}),this.virtualScroll=new Et(r,{touchMultiplier:x,wheelMultiplier:S,normalizeWheel:M}),this.virtualScroll.on("scroll",this.onVirtualScroll)}destroy(){this.emitter.destroy(),this.options.wrapper.removeEventListener("scroll",this.onScroll,{passive:!1}),this.virtualScroll.destroy(),this.dimensions.destroy(),this.toggleClass("lenis",!1),this.toggleClass("lenis-smooth",!1),this.toggleClass("lenis-scrolling",!1),this.toggleClass("lenis-stopped",!1),this.toggleClass("lenis-locked",!1)}on(t,e){return this.emitter.on(t,e)}off(t,e){return this.emitter.off(t,e)}setScroll(t){this.isHorizontal?this.rootElement.scrollLeft=t:this.rootElement.scrollTop=t}resize(){this.dimensions.resize()}emit(){this.emitter.emit("scroll",this)}reset(){this.isLocked=!1,this.isScrolling=!1,this.velocity=0,this.animate.stop()}start(){this.isStopped=!1,this.reset()}stop(){this.isStopped=!0,this.animate.stop(),this.reset()}raf(t){let e=t-(this.time||t);this.time=t,this.animate.advance(.001*e)}scrollTo(t,{offset:e=0,immediate:s=!1,lock:r=!1,duration:n=this.options.duration,easing:h=this.options.easing,lerp:a=!n&&this.options.lerp,onComplete:o=null,force:l=!1,programmatic:c=!0}={}){if(!this.isStopped&&!this.isLocked||l){if(["top","left","start"].includes(t))t=0;else if(["bottom","right","end"].includes(t))t=this.limit;else{var f;let p;if(typeof t=="string"?p=document.querySelector(t):(f=t)!=null&&f.nodeType&&(p=t),p){if(this.options.wrapper!==window){let u=this.options.wrapper.getBoundingClientRect();e-=this.isHorizontal?u.left:u.top}let d=p.getBoundingClientRect();t=(this.isHorizontal?d.left:d.top)+this.animatedScroll}}if(typeof t=="number"){if(t+=e,t=Math.round(t),this.options.infinite?c&&(this.targetScroll=this.animatedScroll=this.scroll):t=et(0,t,this.limit),s)return this.animatedScroll=this.targetScroll=t,this.setScroll(this.scroll),this.reset(),void(o==null||o(this));if(!c){if(t===this.targetScroll)return;this.targetScroll=t}this.animate.fromTo(this.animatedScroll,t,{duration:n,easing:h,lerp:a,onStart:()=>{r&&(this.isLocked=!0),this.isScrolling=!0},onUpdate:(p,d)=>{this.isScrolling=!0,this.velocity=p-this.animatedScroll,this.direction=Math.sign(this.velocity),this.animatedScroll=p,this.setScroll(this.scroll),c&&(this.targetScroll=p),d||this.emit(),d&&requestAnimationFrame(()=>{this.reset(),this.emit(),o==null||o(this)})}})}}}get rootElement(){return this.options.wrapper===window?this.options.content:this.options.wrapper}get limit(){return this.dimensions.limit[this.isHorizontal?"x":"y"]}get isHorizontal(){return this.options.orientation==="horizontal"}get actualScroll(){return this.isHorizontal?this.rootElement.scrollLeft:this.rootElement.scrollTop}get scroll(){return this.options.infinite?(this.animatedScroll%(t=this.limit)+t)%t:this.animatedScroll;var t}get progress(){return this.limit===0?1:this.scroll/this.limit}get isSmooth(){return this.__isSmooth}set isSmooth(t){this.__isSmooth!==t&&(this.__isSmooth=t,this.toggleClass("lenis-smooth",t))}get isScrolling(){return this.__isScrolling}set isScrolling(t){this.__isScrolling!==t&&(this.__isScrolling=t,this.toggleClass("lenis-scrolling",t))}get isStopped(){return this.__isStopped}set isStopped(t){this.__isStopped!==t&&(this.__isStopped=t,this.toggleClass("lenis-stopped",t))}get isLocked(){return this.__isLocked}set isLocked(t){this.__isLocked!==t&&(this.__isLocked=t,this.toggleClass("lenis-locked",t))}get className(){let t="lenis";return this.isStopped&&(t+=" lenis-stopped"),this.isLocked&&(t+=" lenis-locked"),this.isScrolling&&(t+=" lenis-scrolling"),this.isSmooth&&(t+=" lenis-smooth"),t}toggleClass(t,e){this.rootElement.classList.toggle(t,e),this.emitter.emit("className change",this)}};function Xt(i){return i===1?1:1-Math.pow(2,-10*i)}var rt=class extends st{constructor(){super({lerp:.1,infinite:!0,orientation:"horizontal",gestureOrientation:"both",normalizeWheel:!1,smoothTouch:!1}),this.isActive=!0,this.callbacks=[],this.init(),window.sscroll=this}init(){this.y=window.scrollX,this.max=window.innerHeight,this.speed=0,this.percent=this.y/(document.body.scrollHeight-window.innerHeight),this.on("scroll",({scroll:t,limit:e,velocity:s,progress:r})=>{this.y=t||0,this.speed=s||0,this.percent=r||0,this.callbackRaf()})}to(t){this.scrollTo(t,{offset:0,duration:.8,easing:Xt,immediate:!1})}resize(){}render(t){this.isActive&&this.raf(t)}set active(t){this.isActive=t}callbackRaf(){this.callbacks.forEach(t=>t())}subscribe(t){this.callbacks.push(t)}unsubscribe(t){this.callbacks=this.callbacks.filter(e=>e!==t)}unsunbscribeAll(){this.callbacks=[]}onNavigateIn(){}};function R(){if(!(this instanceof R))return new R;this.size=0,this.uid=0,this.selectors=[],this.selectorObjects={},this.indexes=Object.create(this.indexes),this.activeIndexes=[]}var W=window.document.documentElement,Si=W.matches||W.webkitMatchesSelector||W.mozMatchesSelector||W.oMatchesSelector||W.msMatchesSelector;R.prototype.matchesSelector=function(i,t){return Si.call(i,t)};R.prototype.querySelectorAll=function(i,t){return t.querySelectorAll(i)};R.prototype.indexes=[];var Ti=/^#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;R.prototype.indexes.push({name:"ID",selector:function(t){var e;if(e=t.match(Ti))return e[0].slice(1)},element:function(t){if(t.id)return[t.id]}});var bi=/^\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;R.prototype.indexes.push({name:"CLASS",selector:function(t){var e;if(e=t.match(bi))return e[0].slice(1)},element:function(t){var e=t.className;if(e){if(typeof e=="string")return e.split(/\s/);if(typeof e=="object"&&"baseVal"in e)return e.baseVal.split(/\s/)}}});var Fi=/^((?:[\w\u00c0-\uFFFF\-]|\\.)+)/g;R.prototype.indexes.push({name:"TAG",selector:function(t){var e;if(e=t.match(Fi))return e[0].toUpperCase()},element:function(t){return[t.nodeName.toUpperCase()]}});R.prototype.indexes.default={name:"UNIVERSAL",selector:function(){return!0},element:function(){return[!0]}};var St;typeof window.Map=="function"?St=window.Map:St=function(){function i(){this.map={}}return i.prototype.get=function(t){return this.map[t+" "]},i.prototype.set=function(t,e){this.map[t+" "]=e},i}();var Ht=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g;function Yt(i,t){i=i.slice(0).concat(i.default);var e=i.length,s,r,n,h,a=t,o,l,c=[];do if(Ht.exec(""),(n=Ht.exec(a))&&(a=n[3],n[2]||!a)){for(s=0;s<e;s++)if(l=i[s],o=l.selector(n[1])){for(r=c.length,h=!1;r--;)if(c[r].index===l&&c[r].key===o){h=!0;break}h||c.push({index:l,key:o});break}}while(n);return c}function Ai(i,t){var e,s,r;for(e=0,s=i.length;e<s;e++)if(r=i[e],t.isPrototypeOf(r))return r}R.prototype.logDefaultIndexUsed=function(){};R.prototype.add=function(i,t){var e,s,r,n,h,a,o,l,c=this.activeIndexes,f=this.selectors,p=this.selectorObjects;if(typeof i=="string"){for(e={id:this.uid++,selector:i,data:t},p[e.id]=e,o=Yt(this.indexes,i),s=0;s<o.length;s++)l=o[s],n=l.key,r=l.index,h=Ai(c,r),h||(h=Object.create(r),h.map=new St,c.push(h)),r===this.indexes.default&&this.logDefaultIndexUsed(e),a=h.map.get(n),a||(a=[],h.map.set(n,a)),a.push(e);this.size++,f.push(i)}};R.prototype.remove=function(i,t){if(typeof i=="string"){var e,s,r,n,h,a,o,l,c=this.activeIndexes,f=this.selectors=[],p=this.selectorObjects,d={},u=arguments.length===1;for(e=Yt(this.indexes,i),r=0;r<e.length;r++)for(s=e[r],n=c.length;n--;)if(a=c[n],s.index.isPrototypeOf(a)){if(o=a.map.get(s.key),o)for(h=o.length;h--;)l=o[h],l.selector===i&&(u||l.data===t)&&(o.splice(h,1),d[l.id]=!0);break}for(r in d)delete p[r],this.size--;for(r in p)f.push(p[r].selector)}};function Qt(i,t){return i.id-t.id}R.prototype.queryAll=function(i){if(!this.selectors.length)return[];var t={},e=[],s=this.querySelectorAll(this.selectors.join(", "),i),r,n,h,a,o,l,c,f;for(r=0,h=s.length;r<h;r++)for(o=s[r],l=this.matches(o),n=0,a=l.length;n<a;n++)f=l[n],t[f.id]?c=t[f.id]:(c={id:f.id,selector:f.selector,data:f.data,elements:[]},t[f.id]=c,e.push(c)),c.elements.push(o);return e.sort(Qt)};R.prototype.matches=function(i){if(!i)return[];var t,e,s,r,n,h,a,o,l,c,f,p=this.activeIndexes,d={},u=[];for(t=0,r=p.length;t<r;t++)if(a=p[t],o=a.element(i),o){for(e=0,n=o.length;e<n;e++)if(l=a.map.get(o[e]))for(s=0,h=l.length;s<h;s++)c=l[s],f=c.id,!d[f]&&this.matchesSelector(i,c.selector)&&(d[f]=!0,u.push(c))}return u.sort(Qt)};var k={},I={},nt=["mouseenter","mouseleave","pointerenter","pointerleave","blur","focus"];function Tt(i){I[i]===void 0&&(I[i]=new Set)}function $t(i,t){I[i]&&I[i].forEach(e=>{e(...t)})}function bt(i){return typeof i=="string"?document.querySelectorAll(i):i}function X(i){let t=_i(k[i.type],i.target);if(t.length)for(let e=0;e<t.length;e++)for(let s=0;s<t[e].stack.length;s++)nt.indexOf(i.type)!==-1?(Zt(i,t[e].delegatedTarget),i.target===t[e].delegatedTarget&&t[e].stack[s].data(i)):(Zt(i,t[e].delegatedTarget),t[e].stack[s].data(i))}function _i(i,t){let e=[],s=t;do{if(s.nodeType!==1)break;let r=i.matches(s);r.length&&e.push({delegatedTarget:s,stack:r})}while(s=s.parentElement);return e}function Zt(i,t){Object.defineProperty(i,"currentTarget",{configurable:!0,enumerable:!0,get:()=>t})}function Kt(i){let t={};for(let e in i)t[e]=[...i[e]];return t}var Ft=class{bindAll(t,e){e||(e=Object.getOwnPropertyNames(Object.getPrototypeOf(t)));for(let s=0;s<e.length;s++)t[e[s]]=t[e[s]].bind(t)}on(t,e,s,r){let n=t.split(" ");for(let h=0;h<n.length;h++){if(typeof e=="function"&&s===void 0){Tt(n[h]),I[n[h]].add(e);continue}if(e.nodeType&&e.nodeType===1||e===window||e===document){e.addEventListener(n[h],s,r);continue}e=bt(e);for(let a=0;a<e.length;a++)e[a].addEventListener(n[h],s,r)}}delegate(t,e,s){let r=t.split(" ");for(let n=0;n<r.length;n++){let h=k[r[n]];h===void 0&&(h=new R,k[r[n]]=h,nt.indexOf(r[n])!==-1?document.addEventListener(r[n],X,!0):document.addEventListener(r[n],X)),h.add(e,s)}}off(t,e,s,r){var h;let n=t.split(" ");for(let a=0;a<n.length;a++){if(e===void 0){(h=I[n[a]])==null||h.clear();continue}if(typeof e=="function"){Tt(n[a]),I[n[a]].delete(e);continue}let o=k[n[a]];if(o!==void 0&&(o.remove(e,s),o.size===0)){delete k[n[a]],nt.indexOf(n[a])!==-1?document.removeEventListener(n[a],X,!0):document.removeEventListener(n[a],X);continue}if(e.removeEventListener!==void 0){e.removeEventListener(n[a],s,r);continue}e=bt(e);for(let l=0;l<e.length;l++)e[l].removeEventListener(n[a],s,r)}}emit(t,...e){$t(t,e)}debugDelegated(){return JSON.parse(JSON.stringify(k))}debugBus(){return Kt(I)}hasBus(t){return this.debugBus().hasOwnProperty(t)}},Li=new Ft,V=Li;var Ci=new DOMParser;function Jt(i){return typeof i=="string"?Ci.parseFromString(i,"text/html"):i}function N(i){let t=new URL(i,window.location.origin),e=null;return t.hash.length&&(e=i.replace(t.hash,"")),{hasHash:t.hash.length>0,pathname:t.pathname,host:t.host,raw:i,href:e||t.href}}function te(i){i.parentNode.replaceChild(At(i),i)}function ee(i){i.parentNode.tagName==="HEAD"?document.head.appendChild(At(i)):document.body.appendChild(At(i))}function At(i){let t=document.createElement("SCRIPT");for(let e=0;e<i.attributes.length;e++){let s=i.attributes[e];t.setAttribute(s.nodeName,s.nodeValue)}return i.innerHTML&&(t.innerHTML=i.innerHTML),t}var B=class{constructor({wrapper:t}){this.wrapper=t}leave(t){return new Promise(e=>{this.onLeave({...t,done:e})})}enter(t){return new Promise(e=>{this.onEnter({...t,done:e})})}onLeave({from:t,trigger:e,done:s}){s()}onEnter({to:t,trigger:e,done:s}){s()}};var q=class{constructor({content:t,page:e,title:s,wrapper:r}){this._contentString=t.outerHTML,this._DOM=null,this.page=e,this.title=s,this.wrapper=r,this.content=this.wrapper.lastElementChild}onEnter(){}onEnterCompleted(){}onLeave(){}onLeaveCompleted(){}initialLoad(){this.onEnter(),this.onEnterCompleted()}update(){document.title=this.title,this.wrapper.appendChild(this._DOM.firstElementChild),this.content=this.wrapper.lastElementChild,this._DOM=null}createDom(){this._DOM||(this._DOM=document.createElement("div"),this._DOM.innerHTML=this._contentString)}remove(){this.wrapper.firstElementChild.remove()}enter(t,e){return new Promise(s=>{this.onEnter(),t.enter({trigger:e,to:this.content}).then(()=>{this.onEnterCompleted(),s()})})}leave(t,e,s){return new Promise(r=>{this.onLeave(),t.leave({trigger:e,from:this.content}).then(()=>{s&&this.remove(),this.onLeaveCompleted(),r()})})}};var H=class{constructor(){P(this,"data",new Map);P(this,"regexCache",new Map)}add(t,e,s){this.data.has(t)||(this.data.set(t,new Map),this.regexCache.set(t,new RegExp(`^${t}$`))),this.data.get(t).set(e,s),this.regexCache.set(e,new RegExp(`^${e}$`))}findMatch(t,e){for(let[s,r]of this.data)if(t.pathname.match(this.regexCache.get(s))){for(let[n,h]of r)if(e.pathname.match(this.regexCache.get(n)))return h;break}return null}};var ie="A transition is currently in progress",j=class{constructor(t={}){P(this,"isTransitioning",!1);P(this,"currentCacheEntry",null);P(this,"cache",new Map);P(this,"activePromises",new Map);P(this,"onClick",t=>{if(!(t.metaKey||t.ctrlKey)){let e=N(t.currentTarget.href);if(this.currentLocation=N(window.location.href),this.currentLocation.host!==e.host)return;if(this.currentLocation.href!==e.href||this.currentLocation.hasHash&&!e.hasHash){t.preventDefault(),this.navigateTo(e.raw,t.currentTarget.dataset.transition||!1,t.currentTarget).catch(s=>console.warn(s));return}!this.currentLocation.hasHash&&!e.hasHash&&t.preventDefault()}});P(this,"onPopstate",()=>{if(window.location.pathname===this.currentLocation.pathname&&!this.isPopping)return!1;if(!this.allowInterruption&&(this.isTransitioning||this.isPopping))return window.history.pushState({},"",this.popTarget),console.warn(ie),!1;this.isPopping||(this.popTarget=window.location.href),this.isPopping=!0,this.navigateTo(window.location.href,!1,"popstate")});P(this,"onPrefetch",t=>{let e=N(t.currentTarget.href);this.currentLocation.host===e.host&&this.preload(t.currentTarget.href,!1)});let{links:e="a:not([target]):not([href^=\\#]):not([data-taxi-ignore])",removeOldContent:s=!0,allowInterruption:r=!1,bypassCache:n=!1,enablePrefetch:h=!0,renderers:a={default:q},transitions:o={default:B},reloadJsFilter:l=f=>f.dataset.taxiReload!==void 0,reloadCssFilter:c=f=>!0}=t;this.renderers=a,this.transitions=o,this.defaultRenderer=this.renderers.default||q,this.defaultTransition=this.transitions.default||B,this.wrapper=document.querySelector("[data-taxi]"),this.reloadJsFilter=l,this.reloadCssFilter=c,this.removeOldContent=s,this.allowInterruption=r,this.bypassCache=n,this.enablePrefetch=h,this.cache=new Map,this.isPopping=!1,this.attachEvents(e),this.currentLocation=N(window.location.href),this.cache.set(this.currentLocation.href,this.createCacheEntry(document.cloneNode(!0),window.location.href)),this.currentCacheEntry=this.cache.get(this.currentLocation.href),this.currentCacheEntry.renderer.initialLoad()}setDefaultRenderer(t){this.defaultRenderer=this.renderers[t]}setDefaultTransition(t){this.defaultTransition=this.transitions[t]}addRoute(t,e,s){this.router||(this.router=new H),this.router.add(t,e,s)}preload(t,e=!1){return t=N(t).href,this.cache.has(t)?Promise.resolve():this.fetch(t,!1).then(async s=>{this.cache.set(t,this.createCacheEntry(s.html,s.url)),e&&this.cache.get(t).renderer.createDom()})}updateCache(t){let e=N(t||window.location.href).href;this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,this.createCacheEntry(document.cloneNode(!0),e))}clearCache(t){let e=N(t||window.location.href).href;this.cache.has(e)&&this.cache.delete(e)}navigateTo(t,e=!1,s=!1){return new Promise((r,n)=>{if(!this.allowInterruption&&this.isTransitioning){n(new Error(ie));return}this.isTransitioning=!0,this.isPopping=!0,this.targetLocation=N(t),this.popTarget=window.location.href;let h=new(this.chooseTransition(e))({wrapper:this.wrapper}),a;if(this.bypassCache||!this.cache.has(this.targetLocation.href)||this.cache.get(this.targetLocation.href).skipCache){let o=this.fetch(this.targetLocation.href).then(l=>{this.cache.set(this.targetLocation.href,this.createCacheEntry(l.html,l.url)),this.cache.get(this.targetLocation.href).renderer.createDom()});a=this.beforeFetch(this.targetLocation,h,s).then(async()=>o.then(async()=>await this.afterFetch(this.targetLocation,h,this.cache.get(this.targetLocation.href),s)))}else this.cache.get(this.targetLocation.href).renderer.createDom(),a=this.beforeFetch(this.targetLocation,h,s).then(async()=>await this.afterFetch(this.targetLocation,h,this.cache.get(this.targetLocation.href),s));a.then(()=>{r()})})}on(t,e){V.on(t,e)}off(t,e){V.off(t,e)}beforeFetch(t,e,s){return V.emit("NAVIGATE_OUT",{from:this.currentCacheEntry,trigger:s}),new Promise(r=>{this.currentCacheEntry.renderer.leave(e,s,this.removeOldContent).then(()=>{s!=="popstate"&&window.history.pushState({},"",t.raw),r()})})}afterFetch(t,e,s,r){return this.currentLocation=t,this.popTarget=this.currentLocation.href,new Promise(n=>{s.renderer.update(),V.emit("NAVIGATE_IN",{from:this.currentCacheEntry,to:s,trigger:r}),this.reloadJsFilter&&this.loadScripts(s.scripts),this.reloadCssFilter&&this.loadStyles(s.styles),r!=="popstate"&&t.href!==s.finalUrl&&window.history.replaceState({},"",s.finalUrl),s.renderer.enter(e,r).then(()=>{V.emit("NAVIGATE_END",{from:this.currentCacheEntry,to:s,trigger:r}),this.currentCacheEntry=s,this.isTransitioning=!1,this.isPopping=!1,n()})})}loadScripts(t){let e=[...t],s=Array.from(document.querySelectorAll("script")).filter(this.reloadJsFilter);for(let r=0;r<s.length;r++)for(let n=0;n<e.length;n++)if(s[r].outerHTML===e[n].outerHTML){te(s[r]),e.splice(n,1);break}for(let r of e)ee(r)}loadStyles(t){let e=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(this.reloadCssFilter);t.forEach(s=>{s.href&&!e.find(r=>r.href===s.href)&&document.body.append(s)})}attachEvents(t){V.delegate("click",t,this.onClick),V.on("popstate",window,this.onPopstate),this.enablePrefetch&&V.delegate("mouseenter focus",t,this.onPrefetch)}fetch(t,e=!0){if(this.activePromises.has(t))return this.activePromises.get(t);let s=new Promise((r,n)=>{let h;fetch(t,{mode:"same-origin",method:"GET",headers:{"X-Requested-With":"Taxi"},credentials:"same-origin"}).then(a=>(a.ok||(n("Taxi encountered a non 2xx HTTP status code"),e&&(window.location.href=t)),h=a.url,a.text())).then(a=>{r({html:Jt(a),url:h})}).catch(a=>{n(a),e&&(window.location.href=t)}).finally(()=>{this.activePromises.delete(t)})});return this.activePromises.set(t,s),s}chooseTransition(t){var s;if(t)return this.transitions[t];let e=(s=this.router)==null?void 0:s.findMatch(this.currentLocation,this.targetLocation);return e?this.transitions[e]:this.defaultTransition}createCacheEntry(t,e){let s=t.querySelector("[data-taxi-view]"),r=s.dataset.taxiView.length?this.renderers[s.dataset.taxiView]:this.defaultRenderer;return r||console.warn(`The Renderer "${s.dataset.taxiView}" was set in the data-taxi-view of the requested page, but not registered in Taxi.`),{page:t,content:s,finalUrl:e,skipCache:s.hasAttribute("data-taxi-nocache"),scripts:this.reloadJsFilter?Array.from(t.querySelectorAll("script")).filter(this.reloadJsFilter):[],styles:this.reloadCssFilter?Array.from(t.querySelectorAll('link[rel="stylesheet"]')).filter(this.reloadCssFilter):[],title:t.title,renderer:new r({wrapper:this.wrapper,title:t.title,content:s,page:t})}}};var ht=class extends j{constructor(){super({links:"a:not([target]):not([href^=\\#]):not([data-taxi-ignore])",removeOldContent:!0,allowInterruption:!1,bypassCache:!1,transitions:{default:Lt}}),window.router=this}useProps(){this.props={from:_t(window.location.href),to:null},this.on("NAVIGATE_OUT",({trigger:t})=>{t==="popstate"?this.props.to=_t(location.href):this.props.to=_t(t.href)})}async transitionOut(t){return await Promise.allSettled([window.app.dom.transitionOut(t)]),Promise.resolve()}async transitionIn(t){return await Promise.allSettled([window.app.dom.transitionIn(t)]),Promise.resolve()}};function _t(i){let e=new URL(i).pathname.split("/"),[,s,r]=e;return[s,r]}var Lt=class{constructor({wrapper:t}){this.wrapper=t}leave(t){return new Promise(e=>{this.onLeave({...t,done:e})})}enter(t){return new Promise(e=>{this.onEnter({...t,done:e})})}onLeave({from:t,trigger:e,done:s}){window.app.pages.transitionOut(t).then(()=>s())}onEnter({to:t,trigger:e,done:s}){window.app.pages.transitionIn(t).then(()=>s())}};function Ct(i){let t=i[0],e=i[1],s=i[2];return Math.sqrt(t*t+e*e+s*s)}function at(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i}function se(i,t,e,s){return i[0]=t,i[1]=e,i[2]=s,i}function zt(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function Rt(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function re(i,t,e){return i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}function ne(i,t,e){return i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i}function lt(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i}function he(i,t){let e=t[0]-i[0],s=t[1]-i[1],r=t[2]-i[2];return Math.sqrt(e*e+s*s+r*r)}function ae(i,t){let e=t[0]-i[0],s=t[1]-i[1],r=t[2]-i[2];return e*e+s*s+r*r}function Ot(i){let t=i[0],e=i[1],s=i[2];return t*t+e*e+s*s}function oe(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i}function le(i,t){return i[0]=1/t[0],i[1]=1/t[1],i[2]=1/t[2],i}function ot(i,t){let e=t[0],s=t[1],r=t[2],n=e*e+s*s+r*r;return n>0&&(n=1/Math.sqrt(n)),i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i}function Pt(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]}function It(i,t,e){let s=t[0],r=t[1],n=t[2],h=e[0],a=e[1],o=e[2];return i[0]=r*o-n*a,i[1]=n*h-s*o,i[2]=s*a-r*h,i}function ce(i,t,e,s){let r=t[0],n=t[1],h=t[2];return i[0]=r+s*(e[0]-r),i[1]=n+s*(e[1]-n),i[2]=h+s*(e[2]-h),i}function pe(i,t,e){let s=t[0],r=t[1],n=t[2],h=e[3]*s+e[7]*r+e[11]*n+e[15];return h=h||1,i[0]=(e[0]*s+e[4]*r+e[8]*n+e[12])/h,i[1]=(e[1]*s+e[5]*r+e[9]*n+e[13])/h,i[2]=(e[2]*s+e[6]*r+e[10]*n+e[14])/h,i}function fe(i,t,e){let s=t[0],r=t[1],n=t[2],h=e[3]*s+e[7]*r+e[11]*n+e[15];return h=h||1,i[0]=(e[0]*s+e[4]*r+e[8]*n)/h,i[1]=(e[1]*s+e[5]*r+e[9]*n)/h,i[2]=(e[2]*s+e[6]*r+e[10]*n)/h,i}function de(i,t,e){let s=t[0],r=t[1],n=t[2];return i[0]=s*e[0]+r*e[3]+n*e[6],i[1]=s*e[1]+r*e[4]+n*e[7],i[2]=s*e[2]+r*e[5]+n*e[8],i}function ue(i,t,e){let s=t[0],r=t[1],n=t[2],h=e[0],a=e[1],o=e[2],l=e[3],c=a*n-o*r,f=o*s-h*n,p=h*r-a*s,d=a*p-o*f,u=o*c-h*p,m=h*f-a*c,g=l*2;return c*=g,f*=g,p*=g,d*=2,u*=2,m*=2,i[0]=s+c+d,i[1]=r+f+u,i[2]=n+p+m,i}var me=function(){let i=[0,0,0],t=[0,0,0];return function(e,s){at(i,e),at(t,s),ot(i,i),ot(t,t);let r=Pt(i,t);return r>1?0:r<-1?Math.PI:Math.acos(r)}}();function ge(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]}var _=class i extends Array{constructor(t=0,e=t,s=t){return super(t,e,s),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,e=t,s=t){return t.length?this.copy(t):(se(this,t,e,s),this)}copy(t){return at(this,t),this}add(t,e){return e?zt(this,t,e):zt(this,this,t),this}sub(t,e){return e?Rt(this,t,e):Rt(this,this,t),this}multiply(t){return t.length?re(this,this,t):lt(this,this,t),this}divide(t){return t.length?ne(this,this,t):lt(this,this,1/t),this}inverse(t=this){return le(this,t),this}len(){return Ct(this)}distance(t){return t?he(this,t):Ct(this)}squaredLen(){return Ot(this)}squaredDistance(t){return t?ae(this,t):Ot(this)}negate(t=this){return oe(this,t),this}cross(t,e){return e?It(this,t,e):It(this,this,t),this}scale(t){return lt(this,this,t),this}normalize(){return ot(this,this),this}dot(t){return Pt(this,t)}equals(t){return ge(this,t)}applyMatrix3(t){return de(this,this,t),this}applyMatrix4(t){return pe(this,this,t),this}scaleRotateMatrix4(t){return fe(this,this,t),this}applyQuaternion(t){return ue(this,this,t),this}angle(t){return me(this,t)}lerp(t,e){return ce(this,this,t,e),this}clone(){return new i(this[0],this[1],this[2])}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){let e=this[0],s=this[1],r=this[2];return this[0]=t[0]*e+t[4]*s+t[8]*r,this[1]=t[1]*e+t[5]*s+t[9]*r,this[2]=t[2]*e+t[6]*s+t[10]*r,this.normalize()}};var xe=new _,Ri=1,Oi=1,we=!1,ct=class{constructor(t,e={}){t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=e,this.id=Ri++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let s in e)this.addAttribute(s,e[s])}addAttribute(t,e){if(this.attributes[t]=e,e.id=Oi++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target=t==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalized=e.normalized||!1,e.stride=e.stride||0,e.offset=e.offset||0,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.divisor=e.instanced||0,e.needsUpdate=!1,e.usage=e.usage||this.gl.STATIC_DRAW,e.buffer||this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else t==="index"?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){let e=!t.buffer;e&&(t.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),e?this.gl.bufferData(t.target,t.data,t.usage):this.gl.bufferSubData(t.target,0,t.data),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((e,{name:s,type:r})=>{if(!this.attributes[s]){console.warn(`active attribute ${s} not being supplied`);return}let n=this.attributes[s];this.gl.bindBuffer(n.target,n.buffer),this.glState.boundBuffer=n.buffer;let h=1;r===35674&&(h=2),r===35675&&(h=3),r===35676&&(h=4);let a=n.size/h,o=h===1?0:h*h*4,l=h===1?0:h*4;for(let c=0;c<h;c++)this.gl.vertexAttribPointer(e+c,a,n.type,n.normalized,n.stride+o,n.offset+c*l),this.gl.enableVertexAttribArray(e+c),this.gl.renderer.vertexAttribDivisor(e+c,n.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw({program:t,mode:e=this.gl.TRIANGLES}){var r;this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),t.attributeLocations.forEach((n,{name:h})=>{let a=this.attributes[h];a.needsUpdate&&this.updateAttribute(a)});let s=2;((r=this.attributes.index)==null?void 0:r.type)===this.gl.UNSIGNED_INT&&(s=4),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*s,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+this.drawRange.start*s):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count)}getPosition(){let t=this.attributes.position;if(t.data)return t;if(!we)return console.warn("No position buffer data found to compute bounds"),we=!0}computeBoundingBox(t){t||(t=this.getPosition());let e=t.data,s=t.size;this.bounds||(this.bounds={min:new _,max:new _,center:new _,scale:new _,radius:1/0});let r=this.bounds.min,n=this.bounds.max,h=this.bounds.center,a=this.bounds.scale;r.set(1/0),n.set(-1/0);for(let o=0,l=e.length;o<l;o+=s){let c=e[o],f=e[o+1],p=e[o+2];r.x=Math.min(c,r.x),r.y=Math.min(f,r.y),r.z=Math.min(p,r.z),n.x=Math.max(c,n.x),n.y=Math.max(f,n.y),n.z=Math.max(p,n.z)}a.sub(n,r),h.add(r,n).divide(2)}computeBoundingSphere(t){t||(t=this.getPosition());let e=t.data,s=t.size;this.bounds||this.computeBoundingBox(t);let r=0;for(let n=0,h=e.length;n<h;n+=s)xe.fromArray(e,n),r=Math.max(r,this.bounds.center.squaredDistance(xe));this.bounds.radius=Math.sqrt(r)}remove(){for(let t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}};var Pi=1,ye={},Y=class{constructor(t,{vertex:e,fragment:s,uniforms:r={},transparent:n=!1,cullFace:h=t.BACK,frontFace:a=t.CCW,depthTest:o=!0,depthWrite:l=!0,depthFunc:c=t.LESS}={}){t.canvas||console.error("gl not passed as first argument to Program"),this.gl=t,this.uniforms=r,this.id=Pi++,e||console.warn("vertex shader not supplied"),s||console.warn("fragment shader not supplied"),this.transparent=n,this.cullFace=h,this.frontFace=a,this.depthTest=o,this.depthWrite=l,this.depthFunc=c,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));let f=t.createShader(t.VERTEX_SHADER);t.shaderSource(f,e),t.compileShader(f),t.getShaderInfoLog(f)!==""&&console.warn(`${t.getShaderInfoLog(f)}
Vertex Shader
${ve(e)}`);let p=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(p,s),t.compileShader(p),t.getShaderInfoLog(p)!==""&&console.warn(`${t.getShaderInfoLog(p)}
Fragment Shader
${ve(s)}`),this.program=t.createProgram(),t.attachShader(this.program,f),t.attachShader(this.program,p),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(f),t.deleteShader(p),this.uniformLocations=new Map;let d=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let g=0;g<d;g++){let x=t.getActiveUniform(this.program,g);this.uniformLocations.set(x,t.getUniformLocation(this.program,x.name));let S=x.name.match(/(\w+)/g);x.uniformName=S[0],x.nameComponents=S.slice(1)}this.attributeLocations=new Map;let u=[],m=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let g=0;g<m;g++){let x=t.getActiveAttrib(this.program,g),S=t.getAttribLocation(this.program,x.name);S!==-1&&(u[S]=x.name,this.attributeLocations.set(x,S))}this.attributeOrder=u.join("")}setBlendFunc(t,e,s,r){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=s,this.blendFunc.dstAlpha=r,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use({flipFaces:t=!1}={}){let e=-1;this.gl.renderer.state.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.state.currentProgram=this.id),this.uniformLocations.forEach((r,n)=>{let h=this.uniforms[n.uniformName];for(let a of n.nameComponents){if(!h)break;if(a in h)h=h[a];else{if(Array.isArray(h.value))break;h=void 0;break}}if(!h)return Me(`Active uniform ${n.name} has not been supplied`);if(h&&h.value===void 0)return Me(`${n.name} uniform is missing a value parameter`);if(h.value.texture)return e=e+1,h.value.update(e),Vt(this.gl,n.type,r,e);if(h.value.length&&h.value[0].texture){let a=[];return h.value.forEach(o=>{e=e+1,o.update(e),a.push(e)}),Vt(this.gl,n.type,r,a)}Vt(this.gl,n.type,r,h.value)}),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}};function Vt(i,t,e,s){s=s.length?Ii(s):s;let r=i.renderer.state.uniformLocations.get(e);if(s.length)if(r===void 0||r.length!==s.length)i.renderer.state.uniformLocations.set(e,s.slice(0));else{if(Vi(r,s))return;r.set?r.set(s):Ni(r,s),i.renderer.state.uniformLocations.set(e,r)}else{if(r===s)return;i.renderer.state.uniformLocations.set(e,s)}switch(t){case 5126:return s.length?i.uniform1fv(e,s):i.uniform1f(e,s);case 35664:return i.uniform2fv(e,s);case 35665:return i.uniform3fv(e,s);case 35666:return i.uniform4fv(e,s);case 35670:case 5124:case 35678:case 35680:return s.length?i.uniform1iv(e,s):i.uniform1i(e,s);case 35671:case 35667:return i.uniform2iv(e,s);case 35672:case 35668:return i.uniform3iv(e,s);case 35673:case 35669:return i.uniform4iv(e,s);case 35674:return i.uniformMatrix2fv(e,!1,s);case 35675:return i.uniformMatrix3fv(e,!1,s);case 35676:return i.uniformMatrix4fv(e,!1,s)}}function ve(i){let t=i.split(`
`);for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join(`
`)}function Ii(i){let t=i.length,e=i[0].length;if(e===void 0)return i;let s=t*e,r=ye[s];r||(ye[s]=r=new Float32Array(s));for(let n=0;n<t;n++)r.set(i[n],n*e);return r}function Vi(i,t){if(i.length!==t.length)return!1;for(let e=0,s=i.length;e<s;e++)if(i[e]!==t[e])return!1;return!0}function Ni(i,t){for(let e=0,s=i.length;e<s;e++)i[e]=t[e]}var Nt=0;function Me(i){Nt>100||(console.warn(i),Nt++,Nt>100&&console.warn("More than 100 program warnings - stopping logs."))}var Dt=new _,Di=1,Q=class{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:s=150,dpr:r=1,alpha:n=!1,depth:h=!0,stencil:a=!1,antialias:o=!1,premultipliedAlpha:l=!1,preserveDrawingBuffer:c=!1,powerPreference:f="default",autoClear:p=!0,webgl:d=2}={}){let u={alpha:n,depth:h,stencil:a,antialias:o,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:f};this.dpr=r,this.alpha=n,this.color=!0,this.depth=h,this.stencil=a,this.premultipliedAlpha=l,this.autoClear=p,this.id=Di++,d===2&&(this.gl=t.getContext("webgl2",u)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",u)),this.gl||console.error("unable to create webgl context"),this.gl.renderer=this,this.setSize(e,s),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=!1,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={x:0,y:0,width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.state.currentProgram=null,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.getExtension("WEBGL_compressed_texture_astc"),this.getExtension("EXT_texture_compression_bptc"),this.getExtension("WEBGL_compressed_texture_s3tc"),this.getExtension("WEBGL_compressed_texture_etc1"),this.getExtension("WEBGL_compressed_texture_pvrtc"),this.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.parameters.maxAnisotropy=this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,this.gl.canvas.style&&Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e,s=0,r=0){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.state.viewport.x=s,this.state.viewport.y=r,this.gl.viewport(s,r,t,e))}setScissor(t,e,s=0,r=0){this.gl.scissor(s,r,t,e)}enable(t){this.state[t]!==!0&&(this.gl.enable(t),this.state[t]=!0)}disable(t){this.state[t]!==!1&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,s,r){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===s&&this.state.blendFunc.dstAlpha===r||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=s,this.state.blendFunc.dstAlpha=r,s!==void 0?this.gl.blendFuncSeparate(t,e,s,r):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,!(this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e)&&(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,e!==void 0?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,s){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][s].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:s,sort:r}){let n=[];if(e&&s&&e.updateFrustum(),t.traverse(h=>{if(!h.visible)return!0;h.draw&&(s&&h.frustumCulled&&e&&!e.frustumIntersectsMesh(h)||n.push(h))}),r){let h=[],a=[],o=[];n.forEach(l=>{l.program.transparent?l.program.depthTest?a.push(l):o.push(l):h.push(l),l.zDepth=0,!(l.renderOrder!==0||!l.program.depthTest||!e)&&(l.worldMatrix.getTranslation(Dt),Dt.applyMatrix4(e.projectionViewMatrix),l.zDepth=Dt.z)}),h.sort(this.sortOpaque),a.sort(this.sortTransparent),o.sort(this.sortUI),n=h.concat(a,o)}return n}render({scene:t,camera:e,target:s=null,update:r=!0,sort:n=!0,frustumCull:h=!0,clear:a}){s===null?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(s),this.setViewport(s.width,s.height)),(a||this.autoClear&&a!==!1)&&(this.depth&&(!s||s.depth)&&(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),r&&t.updateMatrixWorld(),e&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:h,sort:n}).forEach(l=>{l.draw({camera:e})})}};function Ee(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i}function Se(i,t,e,s,r){return i[0]=t,i[1]=e,i[2]=s,i[3]=r,i}function Te(i,t){let e=t[0],s=t[1],r=t[2],n=t[3],h=e*e+s*s+r*r+n*n;return h>0&&(h=1/Math.sqrt(h)),i[0]=e*h,i[1]=s*h,i[2]=r*h,i[3]=n*h,i}function be(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]}function Fe(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function Ae(i,t,e){e=e*.5;let s=Math.sin(e);return i[0]=s*t[0],i[1]=s*t[1],i[2]=s*t[2],i[3]=Math.cos(e),i}function Ut(i,t,e){let s=t[0],r=t[1],n=t[2],h=t[3],a=e[0],o=e[1],l=e[2],c=e[3];return i[0]=s*c+h*a+r*l-n*o,i[1]=r*c+h*o+n*a-s*l,i[2]=n*c+h*l+s*o-r*a,i[3]=h*c-s*a-r*o-n*l,i}function _e(i,t,e){e*=.5;let s=t[0],r=t[1],n=t[2],h=t[3],a=Math.sin(e),o=Math.cos(e);return i[0]=s*o+h*a,i[1]=r*o+n*a,i[2]=n*o-r*a,i[3]=h*o-s*a,i}function Le(i,t,e){e*=.5;let s=t[0],r=t[1],n=t[2],h=t[3],a=Math.sin(e),o=Math.cos(e);return i[0]=s*o-n*a,i[1]=r*o+h*a,i[2]=n*o+s*a,i[3]=h*o-r*a,i}function Ce(i,t,e){e*=.5;let s=t[0],r=t[1],n=t[2],h=t[3],a=Math.sin(e),o=Math.cos(e);return i[0]=s*o+r*a,i[1]=r*o-s*a,i[2]=n*o+h*a,i[3]=h*o-n*a,i}function ze(i,t,e,s){let r=t[0],n=t[1],h=t[2],a=t[3],o=e[0],l=e[1],c=e[2],f=e[3],p,d,u,m,g;return d=r*o+n*l+h*c+a*f,d<0&&(d=-d,o=-o,l=-l,c=-c,f=-f),1-d>1e-6?(p=Math.acos(d),u=Math.sin(p),m=Math.sin((1-s)*p)/u,g=Math.sin(s*p)/u):(m=1-s,g=s),i[0]=m*r+g*o,i[1]=m*n+g*l,i[2]=m*h+g*c,i[3]=m*a+g*f,i}function Re(i,t){let e=t[0],s=t[1],r=t[2],n=t[3],h=e*e+s*s+r*r+n*n,a=h?1/h:0;return i[0]=-e*a,i[1]=-s*a,i[2]=-r*a,i[3]=n*a,i}function Oe(i,t){return i[0]=-t[0],i[1]=-t[1],i[2]=-t[2],i[3]=t[3],i}function Pe(i,t){let e=t[0]+t[4]+t[8],s;if(e>0)s=Math.sqrt(e+1),i[3]=.5*s,s=.5/s,i[0]=(t[5]-t[7])*s,i[1]=(t[6]-t[2])*s,i[2]=(t[1]-t[3])*s;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[r*3+r]&&(r=2);let n=(r+1)%3,h=(r+2)%3;s=Math.sqrt(t[r*3+r]-t[n*3+n]-t[h*3+h]+1),i[r]=.5*s,s=.5/s,i[3]=(t[n*3+h]-t[h*3+n])*s,i[n]=(t[n*3+r]+t[r*3+n])*s,i[h]=(t[h*3+r]+t[r*3+h])*s}return i}function Ie(i,t,e="YXZ"){let s=Math.sin(t[0]*.5),r=Math.cos(t[0]*.5),n=Math.sin(t[1]*.5),h=Math.cos(t[1]*.5),a=Math.sin(t[2]*.5),o=Math.cos(t[2]*.5);return e==="XYZ"?(i[0]=s*h*o+r*n*a,i[1]=r*n*o-s*h*a,i[2]=r*h*a+s*n*o,i[3]=r*h*o-s*n*a):e==="YXZ"?(i[0]=s*h*o+r*n*a,i[1]=r*n*o-s*h*a,i[2]=r*h*a-s*n*o,i[3]=r*h*o+s*n*a):e==="ZXY"?(i[0]=s*h*o-r*n*a,i[1]=r*n*o+s*h*a,i[2]=r*h*a+s*n*o,i[3]=r*h*o-s*n*a):e==="ZYX"?(i[0]=s*h*o-r*n*a,i[1]=r*n*o+s*h*a,i[2]=r*h*a-s*n*o,i[3]=r*h*o+s*n*a):e==="YZX"?(i[0]=s*h*o+r*n*a,i[1]=r*n*o+s*h*a,i[2]=r*h*a-s*n*o,i[3]=r*h*o-s*n*a):e==="XZY"&&(i[0]=s*h*o-r*n*a,i[1]=r*n*o-s*h*a,i[2]=r*h*a+s*n*o,i[3]=r*h*o+s*n*a),i}var Ve=Ee,Ne=Se;var De=be;var Ue=Te;var pt=class extends Array{constructor(t=0,e=0,s=0,r=1){return super(t,e,s,r),this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}get w(){return this[3]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set w(t){this[3]=t,this.onChange()}identity(){return Fe(this),this.onChange(),this}set(t,e,s,r){return t.length?this.copy(t):(Ne(this,t,e,s,r),this.onChange(),this)}rotateX(t){return _e(this,this,t),this.onChange(),this}rotateY(t){return Le(this,this,t),this.onChange(),this}rotateZ(t){return Ce(this,this,t),this.onChange(),this}inverse(t=this){return Re(this,t),this.onChange(),this}conjugate(t=this){return Oe(this,t),this.onChange(),this}copy(t){return Ve(this,t),this.onChange(),this}normalize(t=this){return Ue(this,t),this.onChange(),this}multiply(t,e){return e?Ut(this,t,e):Ut(this,this,t),this.onChange(),this}dot(t){return De(this,t)}fromMatrix3(t){return Pe(this,t),this.onChange(),this}fromEuler(t){return Ie(this,t,t.order),this}fromAxisAngle(t,e){return Ae(this,t,e),this.onChange(),this}slerp(t,e){return ze(this,this,t,e),this.onChange(),this}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this.onChange(),this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}};function ke(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function Be(i,t,e,s,r,n,h,a,o,l,c,f,p,d,u,m,g){return i[0]=t,i[1]=e,i[2]=s,i[3]=r,i[4]=n,i[5]=h,i[6]=a,i[7]=o,i[8]=l,i[9]=c,i[10]=f,i[11]=p,i[12]=d,i[13]=u,i[14]=m,i[15]=g,i}function qe(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Ge(i,t){let e=t[0],s=t[1],r=t[2],n=t[3],h=t[4],a=t[5],o=t[6],l=t[7],c=t[8],f=t[9],p=t[10],d=t[11],u=t[12],m=t[13],g=t[14],x=t[15],S=e*a-s*h,M=e*o-r*h,w=e*l-n*h,v=s*o-r*a,y=s*l-n*a,T=r*l-n*o,A=c*m-f*u,L=c*g-p*u,b=c*x-d*u,F=f*g-p*m,C=f*x-d*m,z=p*x-d*g,E=S*z-M*C+w*F+v*b-y*L+T*A;return E?(E=1/E,i[0]=(a*z-o*C+l*F)*E,i[1]=(r*C-s*z-n*F)*E,i[2]=(m*T-g*y+x*v)*E,i[3]=(p*y-f*T-d*v)*E,i[4]=(o*b-h*z-l*L)*E,i[5]=(e*z-r*b+n*L)*E,i[6]=(g*w-u*T-x*M)*E,i[7]=(c*T-p*w+d*M)*E,i[8]=(h*C-a*b+l*A)*E,i[9]=(s*b-e*C-n*A)*E,i[10]=(u*y-m*w+x*S)*E,i[11]=(f*w-c*y-d*S)*E,i[12]=(a*L-h*F-o*A)*E,i[13]=(e*F-s*L+r*A)*E,i[14]=(m*M-u*v-g*S)*E,i[15]=(c*v-f*M+p*S)*E,i):null}function je(i){let t=i[0],e=i[1],s=i[2],r=i[3],n=i[4],h=i[5],a=i[6],o=i[7],l=i[8],c=i[9],f=i[10],p=i[11],d=i[12],u=i[13],m=i[14],g=i[15],x=t*h-e*n,S=t*a-s*n,M=t*o-r*n,w=e*a-s*h,v=e*o-r*h,y=s*o-r*a,T=l*u-c*d,A=l*m-f*d,L=l*g-p*d,b=c*m-f*u,F=c*g-p*u,C=f*g-p*m;return x*C-S*F+M*b+w*L-v*A+y*T}function kt(i,t,e){let s=t[0],r=t[1],n=t[2],h=t[3],a=t[4],o=t[5],l=t[6],c=t[7],f=t[8],p=t[9],d=t[10],u=t[11],m=t[12],g=t[13],x=t[14],S=t[15],M=e[0],w=e[1],v=e[2],y=e[3];return i[0]=M*s+w*a+v*f+y*m,i[1]=M*r+w*o+v*p+y*g,i[2]=M*n+w*l+v*d+y*x,i[3]=M*h+w*c+v*u+y*S,M=e[4],w=e[5],v=e[6],y=e[7],i[4]=M*s+w*a+v*f+y*m,i[5]=M*r+w*o+v*p+y*g,i[6]=M*n+w*l+v*d+y*x,i[7]=M*h+w*c+v*u+y*S,M=e[8],w=e[9],v=e[10],y=e[11],i[8]=M*s+w*a+v*f+y*m,i[9]=M*r+w*o+v*p+y*g,i[10]=M*n+w*l+v*d+y*x,i[11]=M*h+w*c+v*u+y*S,M=e[12],w=e[13],v=e[14],y=e[15],i[12]=M*s+w*a+v*f+y*m,i[13]=M*r+w*o+v*p+y*g,i[14]=M*n+w*l+v*d+y*x,i[15]=M*h+w*c+v*u+y*S,i}function We(i,t,e){let s=e[0],r=e[1],n=e[2],h,a,o,l,c,f,p,d,u,m,g,x;return t===i?(i[12]=t[0]*s+t[4]*r+t[8]*n+t[12],i[13]=t[1]*s+t[5]*r+t[9]*n+t[13],i[14]=t[2]*s+t[6]*r+t[10]*n+t[14],i[15]=t[3]*s+t[7]*r+t[11]*n+t[15]):(h=t[0],a=t[1],o=t[2],l=t[3],c=t[4],f=t[5],p=t[6],d=t[7],u=t[8],m=t[9],g=t[10],x=t[11],i[0]=h,i[1]=a,i[2]=o,i[3]=l,i[4]=c,i[5]=f,i[6]=p,i[7]=d,i[8]=u,i[9]=m,i[10]=g,i[11]=x,i[12]=h*s+c*r+u*n+t[12],i[13]=a*s+f*r+m*n+t[13],i[14]=o*s+p*r+g*n+t[14],i[15]=l*s+d*r+x*n+t[15]),i}function Xe(i,t,e){let s=e[0],r=e[1],n=e[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*r,i[5]=t[5]*r,i[6]=t[6]*r,i[7]=t[7]*r,i[8]=t[8]*n,i[9]=t[9]*n,i[10]=t[10]*n,i[11]=t[11]*n,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i}function He(i,t,e,s){let r=s[0],n=s[1],h=s[2],a=Math.hypot(r,n,h),o,l,c,f,p,d,u,m,g,x,S,M,w,v,y,T,A,L,b,F,C,z,E,U;return Math.abs(a)<1e-6?null:(a=1/a,r*=a,n*=a,h*=a,o=Math.sin(e),l=Math.cos(e),c=1-l,f=t[0],p=t[1],d=t[2],u=t[3],m=t[4],g=t[5],x=t[6],S=t[7],M=t[8],w=t[9],v=t[10],y=t[11],T=r*r*c+l,A=n*r*c+h*o,L=h*r*c-n*o,b=r*n*c-h*o,F=n*n*c+l,C=h*n*c+r*o,z=r*h*c+n*o,E=n*h*c-r*o,U=h*h*c+l,i[0]=f*T+m*A+M*L,i[1]=p*T+g*A+w*L,i[2]=d*T+x*A+v*L,i[3]=u*T+S*A+y*L,i[4]=f*b+m*F+M*C,i[5]=p*b+g*F+w*C,i[6]=d*b+x*F+v*C,i[7]=u*b+S*F+y*C,i[8]=f*z+m*E+M*U,i[9]=p*z+g*E+w*U,i[10]=d*z+x*E+v*U,i[11]=u*z+S*E+y*U,t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i)}function Ye(i,t){return i[0]=t[12],i[1]=t[13],i[2]=t[14],i}function Bt(i,t){let e=t[0],s=t[1],r=t[2],n=t[4],h=t[5],a=t[6],o=t[8],l=t[9],c=t[10];return i[0]=Math.hypot(e,s,r),i[1]=Math.hypot(n,h,a),i[2]=Math.hypot(o,l,c),i}function Qe(i){let t=i[0],e=i[1],s=i[2],r=i[4],n=i[5],h=i[6],a=i[8],o=i[9],l=i[10],c=t*t+e*e+s*s,f=r*r+n*n+h*h,p=a*a+o*o+l*l;return Math.sqrt(Math.max(c,f,p))}var Ze=function(){let i=[1,1,1];return function(t,e){let s=i;Bt(s,e);let r=1/s[0],n=1/s[1],h=1/s[2],a=e[0]*r,o=e[1]*n,l=e[2]*h,c=e[4]*r,f=e[5]*n,p=e[6]*h,d=e[8]*r,u=e[9]*n,m=e[10]*h,g=a+f+m,x=0;return g>0?(x=Math.sqrt(g+1)*2,t[3]=.25*x,t[0]=(p-u)/x,t[1]=(d-l)/x,t[2]=(o-c)/x):a>f&&a>m?(x=Math.sqrt(1+a-f-m)*2,t[3]=(p-u)/x,t[0]=.25*x,t[1]=(o+c)/x,t[2]=(d+l)/x):f>m?(x=Math.sqrt(1+f-a-m)*2,t[3]=(d-l)/x,t[0]=(o+c)/x,t[1]=.25*x,t[2]=(p+u)/x):(x=Math.sqrt(1+m-a-f)*2,t[3]=(o-c)/x,t[0]=(d+l)/x,t[1]=(p+u)/x,t[2]=.25*x),t}}();function $e(i,t,e,s){let r=t[0],n=t[1],h=t[2],a=t[3],o=r+r,l=n+n,c=h+h,f=r*o,p=r*l,d=r*c,u=n*l,m=n*c,g=h*c,x=a*o,S=a*l,M=a*c,w=s[0],v=s[1],y=s[2];return i[0]=(1-(u+g))*w,i[1]=(p+M)*w,i[2]=(d-S)*w,i[3]=0,i[4]=(p-M)*v,i[5]=(1-(f+g))*v,i[6]=(m+x)*v,i[7]=0,i[8]=(d+S)*y,i[9]=(m-x)*y,i[10]=(1-(f+u))*y,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}function Ke(i,t){let e=t[0],s=t[1],r=t[2],n=t[3],h=e+e,a=s+s,o=r+r,l=e*h,c=s*h,f=s*a,p=r*h,d=r*a,u=r*o,m=n*h,g=n*a,x=n*o;return i[0]=1-f-u,i[1]=c+x,i[2]=p-g,i[3]=0,i[4]=c-x,i[5]=1-l-u,i[6]=d+m,i[7]=0,i[8]=p+g,i[9]=d-m,i[10]=1-l-f,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Je(i,t,e,s,r){let n=1/Math.tan(t/2),h=1/(s-r);return i[0]=n/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=(r+s)*h,i[11]=-1,i[12]=0,i[13]=0,i[14]=2*r*s*h,i[15]=0,i}function ti(i,t,e,s,r,n,h){let a=1/(t-e),o=1/(s-r),l=1/(n-h);return i[0]=-2*a,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*l,i[11]=0,i[12]=(t+e)*a,i[13]=(r+s)*o,i[14]=(h+n)*l,i[15]=1,i}function ei(i,t,e,s){let r=t[0],n=t[1],h=t[2],a=s[0],o=s[1],l=s[2],c=r-e[0],f=n-e[1],p=h-e[2],d=c*c+f*f+p*p;d===0?p=1:(d=1/Math.sqrt(d),c*=d,f*=d,p*=d);let u=o*p-l*f,m=l*c-a*p,g=a*f-o*c;return d=u*u+m*m+g*g,d===0&&(l?a+=1e-6:o?l+=1e-6:o+=1e-6,u=o*p-l*f,m=l*c-a*p,g=a*f-o*c,d=u*u+m*m+g*g),d=1/Math.sqrt(d),u*=d,m*=d,g*=d,i[0]=u,i[1]=m,i[2]=g,i[3]=0,i[4]=f*g-p*m,i[5]=p*u-c*g,i[6]=c*m-f*u,i[7]=0,i[8]=c,i[9]=f,i[10]=p,i[11]=0,i[12]=r,i[13]=n,i[14]=h,i[15]=1,i}function qt(i,t,e){return i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i[4]=t[4]+e[4],i[5]=t[5]+e[5],i[6]=t[6]+e[6],i[7]=t[7]+e[7],i[8]=t[8]+e[8],i[9]=t[9]+e[9],i[10]=t[10]+e[10],i[11]=t[11]+e[11],i[12]=t[12]+e[12],i[13]=t[13]+e[13],i[14]=t[14]+e[14],i[15]=t[15]+e[15],i}function Gt(i,t,e){return i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i[4]=t[4]-e[4],i[5]=t[5]-e[5],i[6]=t[6]-e[6],i[7]=t[7]-e[7],i[8]=t[8]-e[8],i[9]=t[9]-e[9],i[10]=t[10]-e[10],i[11]=t[11]-e[11],i[12]=t[12]-e[12],i[13]=t[13]-e[13],i[14]=t[14]-e[14],i[15]=t[15]-e[15],i}function ii(i,t,e){return i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i[4]=t[4]*e,i[5]=t[5]*e,i[6]=t[6]*e,i[7]=t[7]*e,i[8]=t[8]*e,i[9]=t[9]*e,i[10]=t[10]*e,i[11]=t[11]*e,i[12]=t[12]*e,i[13]=t[13]*e,i[14]=t[14]*e,i[15]=t[15]*e,i}var O=class extends Array{constructor(t=1,e=0,s=0,r=0,n=0,h=1,a=0,o=0,l=0,c=0,f=1,p=0,d=0,u=0,m=0,g=1){return super(t,e,s,r,n,h,a,o,l,c,f,p,d,u,m,g),this}get x(){return this[12]}get y(){return this[13]}get z(){return this[14]}get w(){return this[15]}set x(t){this[12]=t}set y(t){this[13]=t}set z(t){this[14]=t}set w(t){this[15]=t}set(t,e,s,r,n,h,a,o,l,c,f,p,d,u,m,g){return t.length?this.copy(t):(Be(this,t,e,s,r,n,h,a,o,l,c,f,p,d,u,m,g),this)}translate(t,e=this){return We(this,e,t),this}rotate(t,e,s=this){return He(this,s,t,e),this}scale(t,e=this){return Xe(this,e,typeof t=="number"?[t,t,t]:t),this}add(t,e){return e?qt(this,t,e):qt(this,this,t),this}sub(t,e){return e?Gt(this,t,e):Gt(this,this,t),this}multiply(t,e){return t.length?e?kt(this,t,e):kt(this,this,t):ii(this,this,t),this}identity(){return qe(this),this}copy(t){return ke(this,t),this}fromPerspective({fov:t,aspect:e,near:s,far:r}={}){return Je(this,t,e,s,r),this}fromOrthogonal({left:t,right:e,bottom:s,top:r,near:n,far:h}){return ti(this,t,e,s,r,n,h),this}fromQuaternion(t){return Ke(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(t=this){return Ge(this,t),this}compose(t,e,s){return $e(this,t,e,s),this}getRotation(t){return Ze(t,this),this}getTranslation(t){return Ye(t,this),this}getScaling(t){return Bt(t,this),this}getMaxScaleOnAxis(){return Qe(this)}lookAt(t,e,s){return ei(this,t,e,s),this}determinant(){return je(this)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this[4]=t[e+4],this[5]=t[e+5],this[6]=t[e+6],this[7]=t[e+7],this[8]=t[e+8],this[9]=t[e+9],this[10]=t[e+10],this[11]=t[e+11],this[12]=t[e+12],this[13]=t[e+13],this[14]=t[e+14],this[15]=t[e+15],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t[e+4]=this[4],t[e+5]=this[5],t[e+6]=this[6],t[e+7]=this[7],t[e+8]=this[8],t[e+9]=this[9],t[e+10]=this[10],t[e+11]=this[11],t[e+12]=this[12],t[e+13]=this[13],t[e+14]=this[14],t[e+15]=this[15],t}};function si(i,t,e="YXZ"){return e==="XYZ"?(i[1]=Math.asin(Math.min(Math.max(t[8],-1),1)),Math.abs(t[8])<.99999?(i[0]=Math.atan2(-t[9],t[10]),i[2]=Math.atan2(-t[4],t[0])):(i[0]=Math.atan2(t[6],t[5]),i[2]=0)):e==="YXZ"?(i[0]=Math.asin(-Math.min(Math.max(t[9],-1),1)),Math.abs(t[9])<.99999?(i[1]=Math.atan2(t[8],t[10]),i[2]=Math.atan2(t[1],t[5])):(i[1]=Math.atan2(-t[2],t[0]),i[2]=0)):e==="ZXY"?(i[0]=Math.asin(Math.min(Math.max(t[6],-1),1)),Math.abs(t[6])<.99999?(i[1]=Math.atan2(-t[2],t[10]),i[2]=Math.atan2(-t[4],t[5])):(i[1]=0,i[2]=Math.atan2(t[1],t[0]))):e==="ZYX"?(i[1]=Math.asin(-Math.min(Math.max(t[2],-1),1)),Math.abs(t[2])<.99999?(i[0]=Math.atan2(t[6],t[10]),i[2]=Math.atan2(t[1],t[0])):(i[0]=0,i[2]=Math.atan2(-t[4],t[5]))):e==="YZX"?(i[2]=Math.asin(Math.min(Math.max(t[1],-1),1)),Math.abs(t[1])<.99999?(i[0]=Math.atan2(-t[9],t[5]),i[1]=Math.atan2(-t[2],t[0])):(i[0]=0,i[1]=Math.atan2(t[8],t[10]))):e==="XZY"&&(i[2]=Math.asin(-Math.min(Math.max(t[4],-1),1)),Math.abs(t[4])<.99999?(i[0]=Math.atan2(t[6],t[5]),i[1]=Math.atan2(t[8],t[0])):(i[0]=Math.atan2(-t[9],t[10]),i[1]=0)),i}var ri=new O,ft=class extends Array{constructor(t=0,e=t,s=t,r="YXZ"){return super(t,e,s),this.order=r,this.onChange=()=>{},this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t,this.onChange()}set y(t){this[1]=t,this.onChange()}set z(t){this[2]=t,this.onChange()}set(t,e=t,s=t){return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=s,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t,e=this.order){return si(this,t,e),this.onChange(),this}fromQuaternion(t,e=this.order){return ri.fromQuaternion(t),this.fromRotationMatrix(ri,e)}fromArray(t,e=0){return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(t=[],e=0){return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}};var D=class{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new O,this.worldMatrix=new O,this.matrixAutoUpdate=!0,this.worldMatrixNeedsUpdate=!1,this.position=new _,this.quaternion=new pt,this.scale=new _(1),this.rotation=new ft,this.up=new _(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(this.parent===null?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,s=this.children.length;e<s;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,s=this.children.length;e<s;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t,e=!1){e?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}};var Gi=new O,ji=new _,Wi=new _,Z=class extends D{constructor(t,{near:e=.1,far:s=100,fov:r=45,aspect:n=1,left:h,right:a,bottom:o,top:l,zoom:c=1}={}){super(),Object.assign(this,{near:e,far:s,fov:r,aspect:n,left:h,right:a,bottom:o,top:l,zoom:c}),this.projectionMatrix=new O,this.viewMatrix=new O,this.projectionViewMatrix=new O,this.worldPosition=new _,this.type=h||a?"orthographic":"perspective",this.type==="orthographic"?this.orthographic():this.perspective()}perspective({near:t=this.near,far:e=this.far,fov:s=this.fov,aspect:r=this.aspect}={}){return Object.assign(this,{near:t,far:e,fov:s,aspect:r}),this.projectionMatrix.fromPerspective({fov:s*(Math.PI/180),aspect:r,near:t,far:e}),this.type="perspective",this}orthographic({near:t=this.near,far:e=this.far,left:s=this.left||-1,right:r=this.right||1,bottom:n=this.bottom||-1,top:h=this.top||1,zoom:a=this.zoom}={}){return Object.assign(this,{near:t,far:e,left:s,right:r,bottom:n,top:h,zoom:a}),s/=a,r/=a,n/=a,h/=a,this.projectionMatrix.fromOrthogonal({left:s,right:r,bottom:n,top:h,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.worldMatrix.getTranslation(this.worldPosition),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(Gi.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new _,new _,new _,new _,new _,new _]);let t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let e=0;e<6;e++){let s=1/this.frustum[e].distance();this.frustum[e].multiply(s),this.frustum[e].constant*=s}}frustumIntersectsMesh(t,e=t.worldMatrix){if(!t.geometry.attributes.position||((!t.geometry.bounds||t.geometry.bounds.radius===1/0)&&t.geometry.computeBoundingSphere(),!t.geometry.bounds))return!0;let s=ji;s.copy(t.geometry.bounds.center),s.applyMatrix4(e);let r=t.geometry.bounds.radius*e.getMaxScaleOnAxis();return this.frustumIntersectsSphere(s,r)}frustumIntersectsSphere(t,e){let s=Wi;for(let r=0;r<6;r++){let n=this.frustum[r];if(s.copy(n).dot(t)+n.constant<-e)return!1}return!0}};function ni(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],i}function hi(i,t){let e=t[0],s=t[1],r=t[2],n=t[3],h=e+e,a=s+s,o=r+r,l=e*h,c=s*h,f=s*a,p=r*h,d=r*a,u=r*o,m=n*h,g=n*a,x=n*o;return i[0]=1-f-u,i[3]=c-x,i[6]=p+g,i[1]=c+x,i[4]=1-l-u,i[7]=d-m,i[2]=p-g,i[5]=d+m,i[8]=1-l-f,i}function ai(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function oi(i,t,e,s,r,n,h,a,o,l){return i[0]=t,i[1]=e,i[2]=s,i[3]=r,i[4]=n,i[5]=h,i[6]=a,i[7]=o,i[8]=l,i}function li(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=1,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i}function ci(i,t){let e=t[0],s=t[1],r=t[2],n=t[3],h=t[4],a=t[5],o=t[6],l=t[7],c=t[8],f=c*h-a*l,p=-c*n+a*o,d=l*n-h*o,u=e*f+s*p+r*d;return u?(u=1/u,i[0]=f*u,i[1]=(-c*s+r*l)*u,i[2]=(a*s-r*h)*u,i[3]=p*u,i[4]=(c*e-r*o)*u,i[5]=(-a*e+r*n)*u,i[6]=d*u,i[7]=(-l*e+s*o)*u,i[8]=(h*e-s*n)*u,i):null}function jt(i,t,e){let s=t[0],r=t[1],n=t[2],h=t[3],a=t[4],o=t[5],l=t[6],c=t[7],f=t[8],p=e[0],d=e[1],u=e[2],m=e[3],g=e[4],x=e[5],S=e[6],M=e[7],w=e[8];return i[0]=p*s+d*h+u*l,i[1]=p*r+d*a+u*c,i[2]=p*n+d*o+u*f,i[3]=m*s+g*h+x*l,i[4]=m*r+g*a+x*c,i[5]=m*n+g*o+x*f,i[6]=S*s+M*h+w*l,i[7]=S*r+M*a+w*c,i[8]=S*n+M*o+w*f,i}function pi(i,t,e){let s=t[0],r=t[1],n=t[2],h=t[3],a=t[4],o=t[5],l=t[6],c=t[7],f=t[8],p=e[0],d=e[1];return i[0]=s,i[1]=r,i[2]=n,i[3]=h,i[4]=a,i[5]=o,i[6]=p*s+d*h+l,i[7]=p*r+d*a+c,i[8]=p*n+d*o+f,i}function fi(i,t,e){let s=t[0],r=t[1],n=t[2],h=t[3],a=t[4],o=t[5],l=t[6],c=t[7],f=t[8],p=Math.sin(e),d=Math.cos(e);return i[0]=d*s+p*h,i[1]=d*r+p*a,i[2]=d*n+p*o,i[3]=d*h-p*s,i[4]=d*a-p*r,i[5]=d*o-p*n,i[6]=l,i[7]=c,i[8]=f,i}function di(i,t,e){let s=e[0],r=e[1];return i[0]=s*t[0],i[1]=s*t[1],i[2]=s*t[2],i[3]=r*t[3],i[4]=r*t[4],i[5]=r*t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i}function ui(i,t){let e=t[0],s=t[1],r=t[2],n=t[3],h=t[4],a=t[5],o=t[6],l=t[7],c=t[8],f=t[9],p=t[10],d=t[11],u=t[12],m=t[13],g=t[14],x=t[15],S=e*a-s*h,M=e*o-r*h,w=e*l-n*h,v=s*o-r*a,y=s*l-n*a,T=r*l-n*o,A=c*m-f*u,L=c*g-p*u,b=c*x-d*u,F=f*g-p*m,C=f*x-d*m,z=p*x-d*g,E=S*z-M*C+w*F+v*b-y*L+T*A;return E?(E=1/E,i[0]=(a*z-o*C+l*F)*E,i[1]=(o*b-h*z-l*L)*E,i[2]=(h*C-a*b+l*A)*E,i[3]=(r*C-s*z-n*F)*E,i[4]=(e*z-r*b+n*L)*E,i[5]=(s*b-e*C-n*A)*E,i[6]=(m*T-g*y+x*v)*E,i[7]=(g*w-u*T-x*M)*E,i[8]=(u*y-m*w+x*S)*E,i):null}var dt=class extends Array{constructor(t=1,e=0,s=0,r=0,n=1,h=0,a=0,o=0,l=1){return super(t,e,s,r,n,h,a,o,l),this}set(t,e,s,r,n,h,a,o,l){return t.length?this.copy(t):(oi(this,t,e,s,r,n,h,a,o,l),this)}translate(t,e=this){return pi(this,e,t),this}rotate(t,e=this){return fi(this,e,t),this}scale(t,e=this){return di(this,e,t),this}multiply(t,e){return e?jt(this,t,e):jt(this,this,t),this}identity(){return li(this),this}copy(t){return ai(this,t),this}fromMatrix4(t){return ni(this,t),this}fromQuaternion(t){return hi(this,t),this}fromBasis(t,e,s){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],s[0],s[1],s[2]),this}inverse(t=this){return ci(this,t),this}getNormalMatrix(t){return ui(this,t),this}};var Hi=0,$=class extends D{constructor(t,{geometry:e,program:s,mode:r=t.TRIANGLES,frustumCulled:n=!0,renderOrder:h=0}={}){super(),t.canvas||console.error("gl not passed as first argument to Mesh"),this.gl=t,this.id=Hi++,this.geometry=e,this.program=s,this.mode=r,this.frustumCulled=n,this.renderOrder=h,this.modelViewMatrix=new O,this.normalMatrix=new dt,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw({camera:t}={}){t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.worldPosition,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix),this.beforeRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:t}));let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(s=>s&&s({mesh:this,camera:t}))}};var mi=new Uint8Array(4);function gi(i){return(i&i-1)===0}var Yi=1,G=class{constructor(t,{image:e,target:s=t.TEXTURE_2D,type:r=t.UNSIGNED_BYTE,format:n=t.RGBA,internalFormat:h=n,wrapS:a=t.CLAMP_TO_EDGE,wrapT:o=t.CLAMP_TO_EDGE,generateMipmaps:l=!0,minFilter:c=l?t.NEAREST_MIPMAP_LINEAR:t.LINEAR,magFilter:f=t.LINEAR,premultiplyAlpha:p=!1,unpackAlignment:d=4,flipY:u=s==t.TEXTURE_2D,anisotropy:m=0,level:g=0,width:x,height:S=x}={}){this.gl=t,this.id=Yi++,this.image=e,this.target=s,this.type=r,this.format=n,this.internalFormat=h,this.minFilter=c,this.magFilter=f,this.wrapS=a,this.wrapT=o,this.generateMipmaps=l,this.premultiplyAlpha=p,this.unpackAlignment=d,this.flipY=u,this.anisotropy=Math.min(m,this.gl.renderer.parameters.maxAnisotropy),this.level=g,this.width=x,this.height=S,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT,this.state.anisotropy=0}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(t=0){let e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),!!e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let s=0;s<6;s++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,this.level,this.internalFormat,this.format,this.type,this.image[s]);else if(ArrayBuffer.isView(this.image))this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);else if(this.image.isCompressedTexture)for(let s=0;s<this.image.length;s++)this.gl.compressedTexImage2D(this.target,s,this.internalFormat,this.image[s].width,this.image[s].height,0,this.image[s].data);else this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(!this.gl.renderer.isWebgl2&&(!gi(this.image.width)||!gi(this.image.height))?(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR):this.gl.generateMipmap(this.target)),this.onUpdate&&this.onUpdate()}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let s=0;s<6;s++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,mi);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,mi);this.store.image=this.image}}};var K=class i extends ct{constructor(t,{width:e=1,height:s=1,widthSegments:r=1,heightSegments:n=1,attributes:h={}}={}){let a=r,o=n,l=(a+1)*(o+1),c=a*o*6,f=new Float32Array(l*3),p=new Float32Array(l*3),d=new Float32Array(l*2),u=c>65536?new Uint32Array(c):new Uint16Array(c);i.buildPlane(f,p,d,u,e,s,0,a,o),Object.assign(h,{position:{size:3,data:f},normal:{size:3,data:p},uv:{size:2,data:d},index:{data:u}}),super(t,h)}static buildPlane(t,e,s,r,n,h,a,o,l,c=0,f=1,p=2,d=1,u=-1,m=0,g=0){let x=m,S=n/o,M=h/l;for(let w=0;w<=l;w++){let v=w*M-h/2;for(let y=0;y<=o;y++,m++){let T=y*S-n/2;if(t[m*3+c]=T*d,t[m*3+f]=v*u,t[m*3+p]=a/2,e[m*3+c]=0,e[m*3+f]=0,e[m*3+p]=a>=0?1:-1,s[m*2]=y/o,s[m*2+1]=1-w/l,w===l||y===o)continue;let A=x+y+w*(o+1),L=x+y+(w+1)*(o+1),b=x+y+(w+1)*(o+1)+1,F=x+y+w*(o+1)+1;r[g*6]=A,r[g*6+1]=L,r[g*6+2]=F,r[g*6+3]=L,r[g*6+4]=b,r[g*6+5]=F,g++}}}};var ut=class extends Z{constructor(t,{fov:e=25}){super();P(this,"fov",25);this.gl=t}get fovInRad(){return this.fov*Math.PI/180}getViewSize(t){let e=Math.abs(this.position.z*Math.tan(this.fovInRad/2)*2);return{w:e*t,h:e}}};var xi=`#define MPI 3.1415926538
#define MTAU 6.28318530718
attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat3 normalMatrix;uniform float u_time;uniform float u_x;uniform vec4 u_p;uniform vec2 u_diff_wh;varying vec3 v_normal;varying vec2 v_uv;vec2 imageuv(vec2 uv,vec2 size,vec2 resolution){vec2 ratio=vec2(min((resolution.x/resolution.y)/(size.x/size.y),1.0),min((resolution.y/resolution.x)/(size.y/size.x),1.0));return vec2(uv.x*ratio.x+(1.0-ratio.x)*0.5,uv.y*ratio.y+(1.0-ratio.y)*0.5);}void main(){vec3 pos=position;pos.xy*=u_p.zw;pos.x+=u_p.x-u_x;pos.y+=u_p.y;gl_Position=projectionMatrix*modelViewMatrix*vec4(pos,1.0);v_normal=normalize(normalMatrix*normal);v_uv=imageuv(uv,u_diff_wh,u_p.zw);}`;var wi="precision highp float;uniform sampler2D u_diff;varying vec3 v_normal;varying vec2 v_uv;void main(){vec3 diff=texture2D(u_diff,v_uv).rgb;gl_FragColor.rgb=diff;gl_FragColor.a=1.;}";var mt=class extends Y{constructor(i,t={}){super(i,{vertex:xi,fragment:wi,transparent:!0,cullFace:null}),this.uniforms={u_time:{value:0},u_diff:{value:new G(i)},u_diff_wh:{value:[0,0]},u_x:{value:0},u_p:{value:[1,1,1,1]}}}set time(i){this.uniforms.u_time.value=i}set up(i){this.uniforms.u_p.value=i}set x(i){this.uniforms.u_x.value=i}};var $i=i=>{var s,r;let t=i.getBoundingClientRect(),e=0;return e=(r=(s=window.app)==null?void 0:s.scroll)==null?void 0:r.y,{top:t.top,left:t.left,width:t.width,height:t.height,wh:window.innerHeight,ww:window.innerWidth}},yi=(i,t=window.app.gl.vp.px)=>{let e=$i(i),s=window.app.scroll.y;e.left+=s;for(let[r,n]of Object.entries(e))e[r]=n*t;return e};async function vi(i,t){return new Promise(e=>{let s=new Image;s.crossOrigin="anonymous",s.src=t,s.onload=()=>{let r=new G(i,{image:s});r.wh=[s.width,s.height],e(r)}})}var gt=class extends ${constructor(t,{el:e,src:s}){super(t,{geometry:new K(t),program:new mt(t)}),this.gl=t,this.el=e,this.src=s,this.resize(),this.load()}async load(){this.tx=await vi(this.gl,this.src),this.program.uniforms.u_diff.value=this.tx,this.program.uniforms.u_diff_wh.value=this.tx.wh,this.el.style.visibility="hidden"}resize(){let t=yi(this.el);this.program.up=[-t.ww/2+t.left+t.width/2,t.wh/2-t.top-t.height/2,t.width,t.height]}render(t,e){this.program.time=t,this.program.x=e}};var xt=class extends D{constructor(i,t={}){super(),this.gl=i,this.isOn=!0,setTimeout(()=>this.create(),1)}create(){this.images=[...document.querySelectorAll(".cover-img")].map((i,t)=>{let e=new gt(this.gl,{el:i.parentElement,src:i.src});return this.addChild(e),e})}resize(i){var t;this.vp=i,(t=this.images)==null||t.forEach(e=>e.resize(i))}render(i,t){var s,r;if(!this.isOn)return;let e=t*((s=window.app)==null?void 0:s.gl.vp.px)||0;(r=this.images)==null||r.forEach(n=>n.render(i,e))}};var wt=class{constructor(){this.wrapper=document.querySelector("[data-gl='c']"),this.vp={dpr:Math.min(window.devicePixelRatio,2)},this.renderer=new Q({dpr:2,alpha:!0}),this.gl=this.renderer.gl,this.gl.clearColor(0,0,0,0),this.gl.vp=this.vp,this.wrapper.appendChild(this.gl.canvas),this.camera=new ut(this.gl,{}),this.camera.position.set(0,0,5),this.scene=new xt(this.gl),this.time=0,this.initEvents(),this.render()}render(i=0){var t;this.time+=.5,(t=this.scene)==null||t.render(this.time,i),this.renderer.render({scene:this.scene,camera:this.camera})}initEvents(){new ResizeObserver(i=>this.resize(i[0].contentRect)).observe(this.wrapper),this.mouse={x:0,y:0}}resize(i){let t=i?i.width:this.wrapper.clientWidth,e=i?i.height:this.wrapper.clientHeight;this.vp.w=t,this.vp.h=e,this.vp.ratio=t/e,this.vp.viewSize=this.camera.getViewSize(this.vp.ratio),this.vp.px=this.vp.viewSize.w/this.vp.w,this.gl.vp=this.vp,this.renderer.setSize(this.vp.w,this.vp.h),this.camera.perspective({aspect:this.vp.ratio}),this.scene.resize(this.vp)}};var Wt=class{constructor(){this.body=document.querySelector("body"),this.viewport=new tt,this.time=0,this.init()}init(){this.scroll=new rt,this.pages=new ht,this.dom=new J,this.gl=new wt,this.initEvents(),this.render()}initEvents(){new ResizeObserver(t=>this.resize(t[0])).observe(this.body)}resize({contentRect:t}){var e,s;(e=this.viewport)==null||e.resize(),(s=this.dom)==null||s.resize()}render(t){var e,s,r;(e=this.scroll)==null||e.render(t),(s=this.gl)==null||s.render(this.scroll.y),(r=this.dom)==null||r.render(),window.requestAnimationFrame(this.render.bind(this))}};window.app=new Wt;})();
